<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SensorData</title>
    <link rel="stylesheet" href="adminStyle.css" />
</head>

<body>
    <aside class="side-bar">
        <ul>
            <li>
                <a href="#">
                    <span><i class="fas fa-circle"></i><span>4</span></span>
                    <span>floor</span>
                </a>
                <ul>
                    <li><a href="#" id="4floor-node1">node1</a></li>
                    <li><a href="#" id="4floor-node2">node2</a></li>
                    <li><a href="#" id="4floor-node3">node3</a></li>
                    <li><a href="#" id="4floor-node4">node4</a></li>
                    <li><a href="#" id="4floor-node5">node5</a></li>
                    <li><a href="#" id="4floor-node6">node6</a></li>
                </ul>
            </li>

            <li>
                <a href="#">
                    <span><i class="fas fa-circle"></i><span>3</span></span>
                    <span>floor</span>
                </a>
                <ul>
                    <li><a href="#" id="3floor-node1">node1</a></li>
                    <li><a href="#" id="3floor-node2">node2</a></li>
                    <li><a href="#" id="3floor-node3">node3</a></li>
                    <li><a href="#" id="3floor-node4">node4</a></li>
                    <li><a href="#" id="3floor-node5">node5</a></li>
                    <li><a href="#" id="3floor-node6">node6</a></li>
                </ul>
            </li>

            <li>
                <a href="#">
                    <span><i class="fas fa-circle"></i><span>2</span></span>
                    <span>floor</span>
                </a>
                <ul>
                    <li><a href="#" id="2floor-node1">node1</a></li>
                    <li><a href="#" id="2floor-node2">node2</a></li>
                    <li><a href="#" id="2floor-node3">node3</a></li>
                    <li><a href="#" id="2floor-node4">node4</a></li>
                    <li><a href="#" id="2floor-node5">node5</a></li>
                    <li><a href="#" id="2floor-node6">node6</a></li>
                </ul>
            </li>

            <li>
                <a href="#">
                    <span><i class="fas fa-circle"></i><span>1</span></span>
                    <span>floor</span>
                </a>
                <ul>
                    <li><a href="#" id="1floor-node1">node1</a></li>
                    <li><a href="#" id="1floor-node2">node2</a></li>
                    <li><a href="#" id="1floor-node3">node3</a></li>
                    <li><a href="#" id="1floor-node4">node4</a></li>
                    <li><a href="#" id="1floor-node5">node5</a></li>
                    <li><a href="#" id="1floor-node6">node6</a></li>
                </ul>
            </li>

            <li>
                <a href="#">
                    <span><i class="fas fa-circle"></i><span>B1</span></span>
                    <span>floor</span>
                </a>
                <ul>
                    <li><a href="#" id="B1floor-node1">node1</a></li>
                    <li><a href="#" id="B1floor-node2">node2</a></li>
                    <li><a href="#" id="B1floor-node3">node3</a></li>
                    <li><a href="#" id="B1floor-node4">node4</a></li>
                    <li><a href="#" id="B1floor-node5">node5</a></li>
                    <li><a href="#" id="B1floor-node6">node6</a></li>
                </ul>
            </li>

            <li>
                <a href="#">
                    <span><i class="fas fa-circle"></i><span>B2</span></span>
                    <span>floor</span>
                </a>
                <ul>
                    <li><a href="#" id="B2floor-node1">node1</a></li>
                    <li><a href="#" id="B2floor-node2">node2</a></li>
                    <li><a href="#" id="B2floor-node3">node3</a></li>
                    <li><a href="#" id="B2floor-node4">node4</a></li>
                    <li><a href="#" id="B2floor-node5">node5</a></li>
                    <li><a href="#" id="B2floor-node6">node6</a></li>
                </ul>
            </li>

        </ul>
    </aside>

    <div class="Chart-container">
        <h2>SensorData Chart</h2>
        <p id="selected-node">Selected Node: None</p>
        <canvas id="Chart" width="800" height="400"></canvas>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        var ctx = document.getElementById('Chart').getContext('2d');
        var Chart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], // 초기 라벨(시간)은 비워둠
                datasets: [{
                    label: 'Signal',
                    data: [], // 초기 데이터는 비워둠
                    borderColor: 'rgba(255, 99, 132, 1)',
                    borderWidth: 1,
                    fill: false,
                    lineTension: 0.1
                }]
            },
            options: {
                animation: true, // 실시간 성능을 위해 애니메이션 비활성화
                scales: {
                    x: {
                        type: 'linear',
                        position: 'bottom'
                    }
                }
            }
        });

        let dataIndex = 0;
        let intervalID;

        function addData(chart, label, data) {
            if (chart.data.labels.length > 100) { // 최대 데이터 포인트 수를 100으로 제한
                chart.data.labels.shift(); // 가장 오래된 라벨 제거
                chart.data.datasets.forEach((dataset) => {
                    dataset.data.shift(); // 가장 오래된 데이터 포인트 제거
                });
            }

            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function resetChart() {
            dataIndex = 0;
            Chart.data.labels = [];
            Chart.data.datasets.forEach((dataset) => {
                dataset.data = [];
            });
            Chart.update(); // 기존 데이터 삭제 후 차트를 업데이트하여 리셋 효과
            setTimeout(() => {
                Chart.clear(); // 차트를 완전히 지운 후에 다시 그리기
            }, 100); // 0.1초 후에 차트를 완전히 지움
        }

        function startDataUpdates() {
            intervalID = setInterval(function () {
                const newData = Math.sin(dataIndex * 0.1) * 10;
                addData(Chart, dataIndex, newData);
                dataIndex++;
            }, 200);
        }

            document.addEventListener('DOMContentLoaded', function () {
                // 페이지 로드 시 기본적으로 "1floor-node1"을 선택
                const defaultNode = document.getElementById('1floor-node1');
                if (defaultNode) {
                    defaultNode.click(); // 기본적으로 node1을 클릭한 것처럼 처리
                }
            });

        document.querySelectorAll('.side-bar ul li ul li a').forEach(node => {
            node.addEventListener('click', function (event) {
                event.preventDefault();

                clearInterval(intervalID); // 이전 데이터 업데이트 중단
                resetChart(); // 차트 초기화
                startDataUpdates(); // 새로운 데이터 업데이트 시작

                // 기존에 선택된 항목에서 'active' 클래스를 제거
                document.querySelectorAll('.side-bar ul li ul li a').forEach(item => {
                    item.classList.remove('active');
                    item.classList.remove('clicked');
                });

                // 클릭된 항목에 'active' 클래스 추가
                this.classList.add('active');
                this.classList.add('clicked'); // 클릭된 효과 추가

                // 클릭 후 일정 시간 후 효과 제거
                setTimeout(() => {
                    this.classList.remove('clicked');
                }, 300); // 0.3초 후에 원래 상태로 복귀

                const nodeId = this.id; // 예: "1floor-node1"
                const floorMatch = nodeId.match(/^(\d+|B\d+)floor-/); // "1floor-" 또는 "B1floor-"와 일치
                const nodeName = nodeId.replace(/^(\d+|B\d+)floor-/, ''); // "node1"과 같은 노드 이름 추출

                let floorText = '';
                if (floorMatch) {
                    floorText = floorMatch[1].replace('floor', '') + '층'; // "1층" 또는 "B1층"과 같은 텍스트로 변환
                }

                // 결과를 화면에 표시
                document.getElementById('selected-node').textContent = `${floorText} ${nodeName}`;


            });
        });

        // 초기 데이터 업데이트 시작
        startDataUpdates();

    </script>

</body>

</html>